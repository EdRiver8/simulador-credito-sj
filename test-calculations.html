<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Credit Calculations</title>
    <script src="main.js"></script>
  </head>
  <body>
    <h1>Test Credit Simulator Calculations</h1>
    <div id="test-results"></div>

    <script>
      // Wait for DOM to load
      document.addEventListener("DOMContentLoaded", () => {
        const testResults = document.getElementById("test-results");

        // Test parameters
        const loanAmount = 10000000; // $10M COP
        const interestRate = 12; // 12% EA
        const numberOfPayments = 60; // 5 years
        const paymentFrequency = "monthly";
        const totalInsurance = 50000; // $50K COP per payment

        try {
          console.log("Testing basic loan calculation...");

          // Test 1: Basic PaymentSimulation
          const basicSim = new PaymentSimulation(
            loanAmount,
            interestRate,
            numberOfPayments,
            paymentFrequency,
            totalInsurance
          );
          const basicResult = basicSim.generateAmortizationTable();

          console.log("Basic simulation result:", basicResult);
          const lastRow = basicResult.table[basicResult.table.length - 1];
          console.log("Last payment row:", lastRow);

          let testStatus = "<h2>Test Results</h2>";
          testStatus += `<p><strong>Basic Loan Test:</strong></p>`;
          testStatus += `<p>Final balance: ${lastRow.remainingBalance.toFixed(
            2
          )}</p>`;
          testStatus += `<p>Result: ${
            lastRow.remainingBalance <= 1
              ? "✅ PASS - Balance correctly zeroed"
              : "❌ FAIL - Balance not zeroed"
          }</p>`;

          // Test 2: Single Capital Payment
          console.log("Testing single capital payment...");
          const valores = {
            cuotaInicio: 12,
            valorAbono: 1000000, // $1M COP extra payment
          };

          const singleCapitalSim = new SingleCapitalPaymentSimulation(
            loanAmount,
            interestRate,
            numberOfPayments,
            paymentFrequency,
            totalInsurance,
            valores
          );
          const singleCapitalResult = singleCapitalSim.calculate();

          console.log("Single capital payment result:", singleCapitalResult);
          const lastRowCapital =
            singleCapitalResult.result.table[
              singleCapitalResult.result.table.length - 1
            ];
          console.log("Last payment row (capital):", lastRowCapital);

          testStatus += `<p><strong>Single Capital Payment Test:</strong></p>`;
          testStatus += `<p>Final balance: ${lastRowCapital.remainingBalance.toFixed(
            2
          )}</p>`;
          testStatus += `<p>Result: ${
            lastRowCapital.remainingBalance <= 1
              ? "✅ PASS - Balance correctly zeroed"
              : "❌ FAIL - Balance not zeroed"
          }</p>`;

          // Test 3: Payment Reduction
          console.log("Testing payment reduction...");
          const paymentReductionSim = new PaymentReductionSimulation(
            loanAmount,
            interestRate,
            numberOfPayments,
            paymentFrequency,
            totalInsurance,
            valores
          );
          const paymentReductionResult = paymentReductionSim.calculate();

          console.log("Payment reduction result:", paymentReductionResult);
          const lastRowReduction =
            paymentReductionResult.table[
              paymentReductionResult.table.length - 1
            ];
          console.log("Last payment row (reduction):", lastRowReduction);

          testStatus += `<p><strong>Payment Reduction Test:</strong></p>`;
          testStatus += `<p>Final balance: ${lastRowReduction.remainingBalance.toFixed(
            2
          )}</p>`;
          testStatus += `<p>Result: ${
            lastRowReduction.remainingBalance <= 1
              ? "✅ PASS - Balance correctly zeroed"
              : "❌ FAIL - Balance not zeroed"
          }</p>`;

          testResults.innerHTML = testStatus;
        } catch (error) {
          console.error("Test error:", error);
          testResults.innerHTML = `<h2>Test Results</h2><p>❌ Error occurred: ${error.message}</p>`;
        }
      });
    </script>
  </body>
</html>
